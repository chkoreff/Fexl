#
use "test/common.fxl" \;

(
div
standard "say" \say
# Note that numbers are not defined as symbols in standard.
(check (standard "3") {"VOID"}) \x
say x
)

\parse=(say "(parsing)" parse)
\resolve=(say "(resolving)" resolve)

\parse_string=
	(\x
	\exp==(parse x "source")
	resolve standard exp
	)

\parse_file=
	(\name
	\fh==(fopen name "r")
	is_void fh (error ["Could not open source file " name]);
	\exp==(parse fh name)
	fclose fh
	resolve standard exp
	)

\trace_parse=
	(\parse\x
	say "["
	\f==(parse x)
	say "]"
	f
	)

\parse_string=(trace_parse parse_string)
\parse_file=(trace_parse parse_file)

\do_test=
(\parse
div
\f==parse
f
f
)

\test_1=(do_test; parse_file "test/hello.fxl")
\test_2=(do_test; parse_string ~ say "HI"~)
\test_3=
(
div
\program=
~
say ["x = " (+ 3 4)]
~
\get==(readstr program)
\form==(parse get "")
resolve standard form \fn
say "got it"
fn
)

test_1
test_2
test_3
