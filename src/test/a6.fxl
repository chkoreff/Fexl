#
evaluate;
use "test/common.fxl" \;

\parse=
	(\type\source
	say "(parsing)"
	\form=
		(
		eq type "file" (parse_file source);
		eq type "string" (parse source "");
		eq type "stream" (parse source "");
		void
		)
	say "(resolving)"
	resolved (use_standard form)
	)

\parse=
	(\type\source
	say "["
	\f=(parse type source)
	say "]"
	later f
	)

\do_test=
	(\parse
	div
	\f=parse
	f
	f
	)

\test_1=(later; do_test; parse "file" "test/hello.fxl")
\test_2=(later; do_test; parse "string" ~ say "HI"~)
\test_3=
(later;
div
\program=
~
say ["x = " (+ 3 4)]
~
\get=(readstr program)
\fn=(parse "stream" get)
say "got it"
fn
)

test_1
test_2
test_3
