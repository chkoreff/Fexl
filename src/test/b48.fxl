#
\test_add_sub_mul==
(
say "= test_add_sub_mul"
\try=
	(\x\y
	\x=(bn_from_dec x)
	\y=(bn_from_dec y)
	say ["x   = "x]
	say ["y   = "y]

	\z=(bn_add x y)
	say ["x+y = "z]

	\z=(bn_sub x y)
	say ["x-y = "z]

	\z=(bn_mul x y)
	say ["x*y = "z]

	nl
	)

\try=
	(\x\y
	try x y
	try y x
	)

try "12345678" "12345678"

try "1" "1"

try "12345678901234567890" "98765432109876543210"
## 1219326311370217952237463801111263526900 # here
## 1219326311370217952237463801111263526900 # from bc

try "8" "4"
try "80000000" "400000"
try "9999999999999" "99999999999"
try "80000000" "0"
try "1" "9999999"
try "876543210" "876543210"
)

\test_div==
(
say "= test_div"

\check_result=
	(\x\y\q\r

	\z=(bn_add r; bn_mul q y)
	\ok1=(bn_eq z x)
	\ok2=(or (bn_eq0 y) (bn_lt r y))
	\ok=(and ok1 ok2)
	if (not ok)
		(
		say "^^^ BAD!!"
		say ["x = "x]
		say ["y = "y]
		say ["z = "z]
		die
		)
	)

\try==
	(\x\y
	\x=(bn_from_dec x)
	\y=(bn_from_dec y)

	bn_div x y \q\r

	say ["x = "x]
	say ["y = "y]
	say ["q = "q]
	say ["r = "r]

	check_result x y q r
	nl
	)

# These smaller cases are particularly useful when testing in base 10.
(
try "17" "28"
try "28" "28"
try "28" "100"
try "213" "28"
try "493" "28"

try "8" "0"
try "0" "8"
try "7" "7"
try "9" "1"
try "1" "2"
try "9" "2"
try "9" "10"
try "10" "9"
try "10" "2"

try "99" "1"
try "99" "2"
try "99" "9"
try "10" "1"
try "10" "5"
try "10" "6"
try "10" "9"

try "75" "3"
try "75" "4"
try "758" "1"
try "758" "4"
try "758" "9"

try "37" "38"
try "37" "37"
try "99" "10"
try "90" "19"

try "99" "100"
try "10" "999"

try "99000" "10999"
try "11000" "10999"

try "280" "280"
try "281" "280"
try "280" "281"
try "279" "280"
try "835" "200"

try "1000" "90"

try "1000" "100"
try "1000" "101"
try "1000" "110"
try "1000" "999"
try "1000" "110"
try "7700" "789"

try "1100" "109"
try "1100" "100"
)

(
try "48001147" "10999999"
try "100000000000000" "11"

try
"9570011388692426"
"1009999999369033"

try "77998777" "19999998"
)

(
try
"371456627158437"
"10000000"

try
"371456627158437"
"1"

try "100000001" "11"
try "137062805" "119750762"
try "199999999" "11"
try "81620495483330" "11"
try "2138201673" "119750762"
try "816204954833302305347" "119750762"
try "977411658852960" "81620495483330"

try "10" "1"

try
"71456627158437"
"1"

try
"371456627158437"
"1"
)

(
try "0" "0"
try "8" "0"
try "0" "8"
try "0" "988888"

try "123456789" "1234567890"
try "1234567890" "1234567890"
try "12345678901" "1234567890"
try "123456789012" "1234567890"
try "28544" "28543"
try "1" "1"
try "23" "22"
try "9233" "1234"
try "1294" "1234"
try "1235" "1234"
try "42" "12"

try "12345678901234567890" "12345678901234567890"
try "12345678901234567891" "12345678901234567890"

try "9999" "1990"
try "9999" "1000"

try "0" "1"
try "1" "2"
try "2" "1"
try "10" "238"
try "8888" "8888"

try "8" "1"
try "8" "2"
try "8" "3"
try "9" "2"
try "900" "499"
)

(
try "23" "9986"

try "5" "2"
try "5" "3"
try "10" "1"

try "10" "2"
try "10" "3"

try "238" "29"
try "23" "2"
try "23" "20"

try "23" "3"
try "23" "30"

try "238" "10"
try "2380" "29"

try "1234567890" "123456789"
try "123456789" "28543"

try "8888888888" "22"
try "8888888" "22"
try "888888" "2"

try "99990009" "27"

try "99999999" "2"
try "2" "9"

try "8888888888888888" "22222222222"
try "8888888888888888" "33333777777"
try "12345678" "2"

try "48" "8"
try "49" "8"
try "49" "47"
try "49" "48"
)

(
try "101" "2"

try "200" "2"
try "201" "2"
try "203" "2"
try "207" "2"
try "100" "1"
try "1001" "2"
try "10000001" "2"
)

(
try "3" "2"
try "300" "109"
try "245" "244"
try "244" "244"
try "243" "244"
try "28673" "199"
try "28673" "299"
try "28000" "209"
try "28000" "279"
)

(
try "10" "1"
try "10" "2"
try "10" "3"

try "888888" "2"
try "88888" "2"
try "8888" "2"
try "888" "2"
try "88" "2"

try "888888" "3"
try "88888" "3"
try "8888" "3"
try "888" "3"
try "88" "3"

try "8" "2"
try "30" "2"
try "30" "7"

try "20000" "201"

try "48" "2"
try "28" "2"
try "28" "3"
try "28000" "3"
try "18" "2"

try "28" "13"
try "28" "3"
try "286" "13"
try "286" "14"
try "146" "14"

try "28000000" "300000"

try "20000" "299"
try "20001" "20000"
try "60001" "20000"

try "8" "2"
try "30" "2"

try "4" "2"
)

(
\x="8162049548333023053472662755"
\y="1197507627300036"
try x y

\z=(bn_to_dec; bn_add (bn_from_dec "1234567");
	bn_mul (bn_from_dec x) (bn_from_dec y))
try z x
)

try "123456123456" "123456123457"
try "41597350027988327891245001396567135182" "29936006361007"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"591928965625653576840765"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158"
"591928965625653576840765"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"1"
)

\test_gcd==
(
say "= test_gcd"

\try==
	(\a\b
	\a=(bn_from_dec a)
	\b=(bn_from_dec b)
	\d=(bn_gcd a b)
	say ["a = "a]
	say ["b = "b]
	say ["d = "d]
	nl
	)

try "0" "3"
try "1" "3"
try "3" "1"
try "48" "18"
try "18" "48"
try "48" "48"

(
\x=(bn_from_dec "9774116588529608940783989389983056228593747")
\y=(bn_from_dec "1197507627300036")
\d=(bn_from_dec "301576419113008467374")

\a=(bn_mul x d)
\b=(bn_mul y d)

\a=(bn_to_dec a)
\b=(bn_to_dec b)
try a b
)
)

show_benchmark;
test_add_sub_mul
test_div
test_gcd
