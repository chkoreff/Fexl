#use_new_syntax
# Notation for test constants:
# B = 2^32
# s_max_n = B^n-1
# s_seq_n = sum of (B^i*i) for all 0 <= i <= n.

\s_max_1 = "4294967295"
\s_max_2 = "18446744073709551615"
\s_max_3 = "79228162514264337593543950335"
\s_max_4 = "340282366920938463463374607431768211455"
\s_max_5 = "1461501637330902918203684832716283019655932542975"
\s_n_max_5 = "-1461501637330902918203684832716283019655932542975"

\s_seq_2 = "36893488151714070528"
\s_seq_3 = "237684487579686500932345921536"
\s_seq_5 = "7307508188015644058939862505014600028939081482240"

\test_op=
	(\sym\op\xs\ys
	\\x=(bn_from_dec xs)
	\\y=(bn_from_dec ys)
	\\z1=(op x y)
	\\z2=(op y x)
	say ["x   = "x]
	say ["y   = "y]
	say ["x"sym"y = "z1]
	say ["y"sym"x = "z2]
	nl
	)

\test_all_add=
(
\\try=(test_op "+" bn_add)

say "== add"

try s_max_2 "0"
try s_max_4 "1"
try s_max_2 s_max_3
try "1" "1"
try "0" "0"
try s_max_4 s_max_4
try s_seq_3 s_seq_3
try s_seq_3 s_seq_5
try "0" s_seq_2

try "483" "-5"
try "483" "-483"
try "483" "-500"
try "-483" "-500"
)

\test_all_mul=
(
\\try=(test_op "*" bn_mul)

say "== mul"

try s_max_1 s_max_1
try s_max_2 s_max_1
try s_max_1 s_max_2
try s_max_2 s_max_2
try "42" "61"
try "4294967296" s_seq_3
try "0" s_max_5
try "1" s_max_5
try "2" s_max_3
try "0" s_max_3

try "0" "3"
try "2" "3"
try "2" "-3"
try "0" "-3"
try "-2" "-3"
)

\test_all_sub=
(
\\try=(test_op "-" bn_sub)

say "== sub"

try "0" "0"
try "0" "1"
try "0" "-1"
try "1" "17179869184"
try "1" "18446744073709551616"

try "483" "0"
try "483" "5"
try "483" "480"
try "483" "483"
try "483" "983"

try "483" "-0"
try "483" "-5"
try "483" "-500"

try "-483" "0"
try "-483" "-5"
try "-483" "-480"
try "-483" "-483"
try "-483" "-484"
try "-483" "-983"

try "0" "4294967295"
try "4294967295" "4294967295"
try "4294967295" "1"
try "17" "4"
try "65524498470661708942927990500" "59039978300582461559430136553"
try "65524498470661708942927990500" "17"

try "65524498470661708942927990500" "65524498470661708942927990500"
try "65524498470661708942927990500" "65524498470661708942927990498"
try "4294967296" "8589934592"

try "-65524498470661708942927990500" "59039978300582461559430136553"
try "-65524498470661708942927990500" "-59039978300582461559430136553"
)

\test_all_div=
(
\try=
	(\xs\ys
	\\x=(bn_from_dec xs)
	\\y=(bn_from_dec ys)

	say ["x = "x]
	say ["y = "y]

	bn_div x y \q\r
	say ["q = "q]
	say ["r = "r]
	nl
	)

say "== div"

try "0" "1"
try "0" "0"
try "1" "0"
try "12345" "0"
try "0" "67890"
try "67889" "67890"
try "67890" "67890"
try "67891" "67890"
try "67893" "67890"
try "3" "2"
try "4" "2"
try "93" "7"
try "4294967295" "1"
try "4294967295" "2"
try "4294967295" "3"
try "4294967295" "4"
try "4294967295" "1000000"
try "4294967295" "4294967295"
try "4294967295" "4294967296"
try "838109827" "67890"
try "999838109827"  "999838109827"
try "999838109827" "999838109828"

try "4294967298" "4294967297"
try "4294967299" "4294967297"
try "4294967297" "4294967298"

try "18446744073709551615" "1"
try "999838109827" "52000067890"
try "999838109827" "67890"
try "4294967295" "1431655765"
try "7890" "67890"
try "7890" "1"
try "12345" "12345678901"
try "12345678901" "12345"
try "7654321097876543210" "12345"
try
"12001440269564142337485869106461660452196662573"
"591928965625653576840765"

try "4294967296" "4294967295"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"591928965625653576840765"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158"
"591928965625653576840765"

try "4294967296" "1"
try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"1"

try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"2"
try
"148715051342503275709773970899933826916035082561358767853346382371456627158437"
"74357525671251637854886985449966913458017541280679383926673191185728313579218"

# Test signed division.
try "40572" "231"
try "40572" "-231"
try "-40572" "231"
try "-40572" "-231"

# Demonstrate nonzero high digit in vec_sub_scale.
# q = B^3-1
# r = 1
# y = B^2-1
# x = q*y+r
try
"1461501637330902918124456670183571937988679041026"
"18446744073709551615"

# Demonstrate nonzero carry in vec_add_scale.
# q = B^3
# r = 0
# y = B^5-1
# x = q*y+r
try
"115792089237316195423570985008687907853269984665561335876943319670319585689600"
"1461501637330902918203684832716283019655932542975"
)

\test_all_from_dec=
(
\try=
	(\s
	\\x=(bn_from_dec s)
	say ["s = "(as_str s)]
	say ["x = "x]
	nl
	)

say "== from_dec"

try ""
try "-"

try "0"
try "-0"

try "123x"
try "-123x"

try "000000"
try "-000000"

try "x"
try "-x"

try "+1234567.0" # extra chars
try "-1234567x" # extra chars

try "12345x67"
try "-12345x67"

try "1234567890"
try "123456789012345678901234567 99999"

try "999999999999999999999999999 00000"
try "-999999999999999999999999999 00000"

try "000000000000000000000000"
try "-000000000000000000000000"

try "000000000000000000000001"
try "-000000000000000000000001"

try "100000000000000000000000"
try "-100000000000000000000000"

try s_max_5
try s_n_max_5
)

\test_all_to_dec=
(
\try=
	(\s
	\\x=(bn_from_dec s)
	say ["s = "(as_str s)]
	say ["x = "(bn_to_dec x)]
	nl
	)

say "== to_dec"

try "0"
try "-0"
try "1"
try "+1"
try "-1"
try "-1234"
try "1234"
try "12345678901234567890123"
try "-1234.xyz"
)

\test_all_cmp=
(
\try=
	(\xs\ys
	\\x=(bn_from_dec xs)
	\\y=(bn_from_dec ys)

	say ["x   = "x]
	say ["y   = "y]

	\\z=(bn_cmp x y)
	say ["cmp = "z]

	\\z=(bn_lt x y)
	say ["lt  = "z]

	\\z=(bn_le x y)
	say ["le  = "z]

	\\z=(bn_eq x y)
	say ["eq  = "z]

	\\z=(bn_ne x y)
	say ["ne  = "z]

	\\z=(bn_ge x y)
	say ["ge  = "z]

	\\z=(bn_gt x y)
	say ["gt  = "z]

	nl
	)

say "== cmp"

try "0" "0"
try "0" "1"
try "1" "0"

try "1" "-1"

try "-3" "-2"
try "-3" "-3"
try "-3" "-4"

try "-1" "0"
try "-1" "1"

try "0" "-0"

(
\x="43787383271024612956001571865256580434367"
\y="27275738414552949885070764535755917995816"

\try=
	(\sx\sy
	\\x=(. sx  x)
	\\y=(. sy  y)
	try x x
	try x y
	try y x
	)

try "" ""
try "-" ""
try "" "-"
try "-" "-"
)
)

test_all_add
test_all_mul
test_all_sub
test_all_div
test_all_from_dec
test_all_to_dec
test_all_cmp
