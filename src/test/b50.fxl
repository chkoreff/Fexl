# More big number tests.

# Convert x to bn.
\to_bn=
	(\x
	is_bn x x;
	is_str x (bn_from_dec x);
	is_num x (bn_from_dec; num_str x);
	void
	)

\op1=(\f\x f (to_bn x))
\op2=(\f\x\y f (to_bn x) (to_bn y))

# Redefine math operations.
\is_neg=(op1 bn_is_neg)
\neg=(op1 bn_neg)
\+=(op2 bn_add)
\-=(op2 bn_sub)
\*=(op2 bn_mul)
\/=(op2 bn_div)
\mod=(op2 bn_mod)
\gcd=(op2 bn_gcd)

\test_neg==
(
say "= test_neg"

\try=
	(\x
	\x=x
	\n=(neg x)
	say ["x = "x" "(is_neg x)]
	say ["n = "n" "(is_neg n)]
	nl
	)

try "0"
try "12345678901234567890"
try "-12345678901234567890"
)

\test_mod==
(
say "= test_mod"

\try=
	(\x\y
	\x=x
	\y=y
	\r=(mod x y)
	say ["x = "x]
	say ["y = "y]
	say ["r = "r]
	nl
	)

\try_remain=
	(\r\x\y
	\x=(+ r; * x y)
	try x y

	try (neg x) y
	try x (neg y)
	try (neg x) (neg y)
	)

show_benchmark;

try 0 0
try 5 0
try_remain 3 6 4

try_remain
"676419180088961"
"483821237146311133505379712529943563587985318719415739434420"
"607409070885787798697231238307407918220381194430305060466216"

try_remain
"425145742545503"
"807866304067976453998200530991202444816717925831816151952175"
"472380607152644796929990208481229628125327307202280723444810"
)

\test_gcd==
(
say "= test_gcd"

\try=
	(\a\b
	\a=a
	\b=b
	\d=(gcd a b)

	say ["a = "a]
	say ["b = "b]
	say ["d = "d]
	nl
	)

\try_scale=
	(\d\x\y
	try (* d x) (* d y)
	)

show_benchmark;

try 0 0
try 33 0
try 0 37
try 33 27

try
"50860490530967516571516407928019598417864713724864677692680"
"644100622841993554501404615178362907548620926258092121981762"

try
"644100622841993554501404615178362907548620926258092121981762"
"644100622841993554501404615178362907548620926258092121981762"

try
"54275991115198175608185487523256592210742336399569676224470"
"7642103907676325916847042230817601"

try_scale 4 27 55
try_scale 4 27 66

try_scale
"6560921" # prime
"915576476760754300126302052277" # prime
"605978786957295397256640766063" # prime

try_scale
"977668463783463"
"529140713142509435817924385477685453040519148287032524280423"
"202419417755773900762505824273593838156669421461250599902073"

try_scale
"71163795281382935382030235135765305428163093553988463832487"
"30729177463681358262286046038410429463619174254425788284414"
"500448635501697772947675570477918323912846582856880078653"

try
"86320705019595883540722848693944916952826792635"
"1"

try
"86320705019595883540722848693944916952826792635"
"0"

try
"177431137062530148707035590301" # prime
"37" # prime

try
"134121159551089938749733980473" # prime
"404266037114047" # prime

try_scale
"934251847319859309750839139790710181170853619816293829491849"
"423970011031047"
"063103847305188720070914890909414003867134634859996615370496"
)

test_neg
test_mod
test_gcd
say "END"
